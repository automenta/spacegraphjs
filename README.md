# spacegraph.js: Zooming User Interface Library

## Overview

Spacegraph.js is a general-purpose, extensible JavaScript library for creating interactive 2D and 3D Zooming User Interfaces (ZUIs). Built with Three.js for rendering and supporting HTML elements as nodes, it enables developers to build complex, data-driven visualizations with features like:

*   Fractal-like zooming and panning.
*   A comprehensive scene graph for managing 2D and 3D elements.
*   Support for various node types: HTML content, geometric shapes, and custom user-defined nodes.
*   Force-directed layout engine for automatic graph organization.
*   A flexible event system for reacting to graph interactions.
*   Centralized configuration for customizing default behaviors and appearances.

**Purpose**: To provide a versatile JavaScript library for developers to build visually rich and interactive applications with minimal setup.

---

## Key Features

*   **Zooming User Interface (ZUI)**: Navigate seamlessly between different scales in a fractal-like manner.
*   **2D & 3D Visualization**: Supports both 2D (top-down) and 3D (free-look, spherical) view modes.
*   **Versatile Node System**:
    *   **HTML Nodes**: Render DOM elements directly within the 3D space.
    *   **Shape Nodes**: Create basic geometric shapes (boxes, spheres) via WebGL.
    *   **Registered Nodes**: Define and use custom node types with specific appearances and behaviors.
*   **Edge System**: Connect nodes with customizable lines, supporting physics constraints.
*   **Force-Directed Layout**: Automatic graph layout based on physics simulation to organize nodes and edges.
*   **Event System**: Subscribe to events like `nodeAdded`, `nodeSelected`, etc., to integrate with your application logic. (See "Event System" section).
*   **Configurable Defaults**: Customize many default aspects of the graph, nodes, and camera via a configuration object. (See "Configuration" section).
*   **Heads-Up Display (HUD)**: Includes an interactive HUD for logs, alerts, and REPL commands (though this is more of a UIManager feature built on top).

---

## Getting Started

### Manual Setup (Directly including the library)

1.  **Get the Code:**
    *   Clone this repository: `git clone https://github.com/automenta/spacegraphjs.git`
    *   Or download the necessary files directly from the `dist/` folder.
    *   You'll primarily need `spacegraph.js` (or its minified version from `dist/`) and the stylesheet `index.css`.

2.  **Builds Available in `dist/` folder:**
    The `dist/` folder contains different builds of the library, generated by Rollup:
    *   `dist/spacegraph.esm.js`: ES Module format (non-minified).
    *   `dist/spacegraph.esm.min.js`: Minified ES Module format (recommended for production).
    *   `dist/spacegraph.umd.js`: UMD format (non-minified), suitable for script tags or CommonJS/AMD.
    *   `dist/spacegraph.umd.min.js`: Minified UMD format.
    *   Sourcemap files (`.map`) are also provided for debugging. The main library file is `spacegraph.js` in the root (source) or the appropriate file in `dist/`.

3.  **Include in HTML:**
    Create an HTML file and include your chosen version of `spacegraph.js` (e.g., `dist/spacegraph.esm.min.js` for modern projects).
    The library now bundles its core dependencies, `three.js` and `gsap`. If you are using the UMD build (`dist/spacegraph.umd.js` or `dist/spacegraph.umd.min.js`) directly in a `<script>` tag without a module system, `THREE` and `gsap` will be expected to be available globally (e.g., included via CDN separately).
    However, if you are using the ES Module build (`dist/spacegraph.esm.js` or `dist/spacegraph.esm.min.js`) as shown in the example below, `three.js` and `gsap` are included in the bundle and no separate import map or CDN include is strictly necessary for them to work with `spacegraph-zui`.

    The example below includes an `importmap` for `three` and `gsap`. This can be useful if you wish to use these libraries directly in your own code with specific versions or share them with other libraries, but it's not required for `spacegraph-zui` itself when using the ESM build.

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>My SpaceGraph App</title>
        <link href="./index.css" rel="stylesheet"/> <!-- Adjust path to your index.css -->
        <style>
            body { margin: 0; overflow: hidden; }
            #my-spacegraph-container { width: 100vw; height: 100vh; }
        </style>
    </head>
    <body>
        <div id="my-spacegraph-container"></div>

        <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.166.1/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.166.1/examples/jsm/",
                "gsap": "https://cdn.jsdelivr.net/npm/gsap@3.12.5/index.js"
            }
        }
        </script>
        <script type="module">
            // Adjust path if you copied dist files elsewhere, or using the root spacegraph.js for development
            import { SpaceGraph } from './dist/spacegraph.esm.min.js';

            const container = document.getElementById('my-spacegraph-container');
            if (container) {
                const graph = new SpaceGraph(container);
                // ... Your application logic ...
                graph.addNode({ type: 'note', content: 'Hello SpaceGraph!' });
                graph.centerView();
            } else {
                console.error("Container element not found!");
            }
        </script>
    </body>
    </html>
    ```

### Installation (Future)

Once published to npm, you will be able to install it via:
```bash
npm install spacegraph-zui --save
```
`three.js` and `gsap` are now bundled with `spacegraph-zui`, so you no longer need to install them separately.

And then import it:
```javascript
import { SpaceGraph } from 'spacegraph-zui';
// or for UMD/CommonJS if applicable and bundler supports it:
// const { SpaceGraph } = require('spacegraph-zui');
```

---

## Basic Usage

Here's a quick example of how to get a simple graph running:

```javascript
import { SpaceGraph } from './dist/spacegraph.esm.js'; // Or your chosen build/path

// Get the container element from your HTML
const graphContainer = document.getElementById('my-spacegraph-container');

// Create a new SpaceGraph instance
const graph = new SpaceGraph(graphContainer);

// Add some nodes
const node1 = graph.addNode({
    type: 'note', // Built-in NoteNode (editable HTML)
    id: 'node-1',
    content: 'Hello!',
    x: -100, y: 0
});

const node2 = graph.addNode({
    type: 'shape', // Built-in ShapeNode
    id: 'node-2',
    shape: 'sphere', // 'box' is also available
    label: 'World!',
    x: 100, y: 0,
    color: 0xff0000 // Red color for the sphere
});

// Add an edge to connect them
if (node1 && node2) {
    graph.addEdge(node1, node2, { color: 0x00ff00 });
}

// Center the view on the nodes
graph.centerView();
```

---

## Configuration

You can customize many default behaviors and appearances by passing a configuration object as the *second* argument to the `SpaceGraph` constructor.

```javascript
const myConfig = {
  rendering: {
    defaultBackgroundColor: 0x222222, // Dark gray background
    defaultBackgroundAlpha: 1.0      // Opaque background
  },
  camera: {
    initialPositionZ: 900,           // Start camera a bit further out
    fov: 65                          // Adjust field of view
  },
  defaults: {
    node: {
      html: { backgroundColor: 'rgba(255, 255, 200, 0.85)' }, // Light yellow HTML nodes
      shape: { color: 0x00aaee, size: 55 }                   // Blueish, slightly larger shapes
    },
    edge: {
      color: 0xcccccc,               // Light gray edges
      thickness: 1                   // Thinner edges
    }
  }
};

// Initialize with the custom configuration
// The second argument is for uiElements (can be {} if not used), third is the config.
// Correction: The prompt stated config is the second argument.
// If uiElements is also needed: new SpaceGraph(container, uiElements, myConfig)
// If only config: new SpaceGraph(container, {}, myConfig) -> This needs to match constructor.
// Let's assume constructor is (container, config, uiElements) or (container, uiElements, config)
// Based on previous subtask, constructor is (containerElement, config = {}, uiElements = {})
const graph = new SpaceGraph(container, myConfig, {});
```
Refer to the API documentation (JSDoc for `SpaceGraphConfig` in `spacegraph.js`) for the full structure and all available options.

---

## Event System

SpaceGraph uses an event emitter to announce significant actions within the graph. You can listen for these events using the `on()` method and stop listening with `off()`.

```javascript
// Listen for when a node is selected
graph.on('nodeSelected', (eventData) => {
  if (eventData.selectedNode) {
    console.log('Node selected:', eventData.selectedNode.id);
    console.log('Previously selected node:', eventData.previouslySelectedNode?.id);
  } else {
    console.log('Node deselected. Previously selected:', eventData.previouslySelectedNode?.id);
  }
});

// Listen for when a new node is added
graph.on('nodeAdded', (eventData) => {
  console.log('New node added to the graph:', eventData.node);
});

// To remove a listener:
// const myCallback = (data) => { /* ... */ };
// graph.on('someEvent', myCallback);
// graph.off('someEvent', myCallback);
```

**Key Events:**
*   `nodeAdded`: When a node is added. (Data: `{ node: BaseNode }`)
*   `nodeRemoved`: When a node is removed. (Data: `{ nodeId: string, node: BaseNode }`)
*   `edgeAdded`: When an edge is added. (Data: `{ edge: Edge }`)
*   `edgeRemoved`: When an edge is removed. (Data: `{ edgeId: string, edge: Edge }`)
*   `nodeSelected`: When a node is selected or deselected. (Data: `{ selectedNode: BaseNode | null, previouslySelectedNode: BaseNode | null }`)
*   `edgeSelected`: When an edge is selected or deselected. (Data: `{ selectedEdge: Edge | null, previouslySelectedEdge: Edge | null }`)

See the API documentation (JSDoc in `spacegraph.js`) for more details on events and their data.

---

## API Documentation

The API documentation is embedded as JSDoc comments directly within the `spacegraph.js` source code.

To generate and view browsable HTML documentation:

1.  **Build the documentation:**
    Run the following command in your terminal at the root of the project:
    ```bash
    npm run docs:build
    ```
    This will generate the documentation in the `./docs/api/` directory.

2.  **View the documentation:**
    You can then view the generated documentation by running:
    ```bash
    npm run docs:view
    ```
    This script will output a message suggesting you open `./docs/api/index.html` in your browser. Alternatively, you can directly open the `./docs/api/index.html` file in your preferred web browser.

If you prefer to read the JSDoc comments directly in the source code, open the `spacegraph.js` file and read the JSDoc blocks (formatted as `/** ... */`) preceding class and method definitions.

---

## Running Examples

The repository includes several HTML files in the root directory (e.g., `example-app-nodes.html`, `example-event-emitter.html`, `example-centralized-config.html`) that demonstrate various features and usage patterns.

To run these examples:
1.  Ensure you have the project files (especially `spacegraph.js` or its builds in `dist/`, and `index.css`).
2.  Open any of the `example-*.html` files directly in your web browser (e.g., by double-clicking them or using a simple HTTP server like `npx serve .` from the project root).

These examples are a great way to see SpaceGraph.js in action and to get started with your own projects.

---

## Testing

A basic testing infrastructure is set up using Vitest.
To run the tests:
```bash
npm test
```
The current test suite primarily covers utility functions and is a work in progress. Contributions to expand test coverage are welcome!

---

## Contributing

We welcome contributions! Please see `CORE_CONCEPTS.md` for an overview of the library's architecture and consider opening an issue to discuss potential changes or features.

---

## License

This project is licensed under the MIT License.
